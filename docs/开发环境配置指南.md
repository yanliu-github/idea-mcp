# IntelliJ IDEA MCP 服务器 - 开发环境配置指南

## 文档信息

- **文档版本**: v1.0
- **创建日期**: 2025-11-13
- **文档状态**: 配置指南
- **项目名称**: IDEA MCP Server

---

## 1. 系统要求

### 1.1 操作系统

- Windows 10/11 (64位)
- macOS 11.0+ (Big Sur或更高)
- Linux (Ubuntu 20.04+, Fedora 34+, 或其他主流发行版)

### 1.2 硬件要求

- **CPU**: 4核心及以上 (推荐8核心)
- **内存**: 最低8GB (推荐16GB或更高)
- **硬盘**: 至少10GB可用空间
- **网络**: 可访问互联网(用于下载依赖)

---

## 2. 必需软件安装

### 2.1 JDK 安装

#### 安装 JDK 17+

**Windows**:
```bash
# 使用 Chocolatey
choco install openjdk17

# 或下载安装包
# https://adoptium.net/zh-CN/temurin/releases/
```

**macOS**:
```bash
# 使用 Homebrew
brew install openjdk@17

# 配置环境变量
echo 'export PATH="/opt/homebrew/opt/openjdk@17/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
```

**Linux (Ubuntu/Debian)**:
```bash
sudo apt update
sudo apt install openjdk-17-jdk
```

**验证安装**:
```bash
java -version
# 输出应包含 "openjdk version "17.x.x""
```

### 2.2 Node.js 安装

#### 安装 Node.js 18+

**Windows**:
```bash
# 使用 Chocolatey
choco install nodejs-lts

# 或下载安装包
# https://nodejs.org/zh-cn/
```

**macOS**:
```bash
# 使用 Homebrew
brew install node@18

# 或使用 nvm (推荐)
brew install nvm
nvm install 18
nvm use 18
```

**Linux**:
```bash
# 使用 nvm (推荐)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18

# 或使用包管理器
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

**验证安装**:
```bash
node --version
# 输出应为 v18.x.x 或更高

npm --version
# 输出应为 9.x.x 或更高
```

### 2.3 Git 安装

**Windows**:
```bash
# 使用 Chocolatey
choco install git

# 或下载安装包
# https://git-scm.com/download/win
```

**macOS**:
```bash
# 通常已预装，如未安装：
brew install git
```

**Linux**:
```bash
sudo apt install git
```

**验证安装**:
```bash
git --version
# 输出应为 git version 2.x.x
```

### 2.4 Gradle 安装 (可选)

项目使用 Gradle Wrapper，可以不单独安装 Gradle。如需全局使用：

**Windows**:
```bash
choco install gradle
```

**macOS**:
```bash
brew install gradle
```

**Linux**:
```bash
# 下载并解压
wget https://services.gradle.org/distributions/gradle-8.5-bin.zip
unzip gradle-8.5-bin.zip
sudo mv gradle-8.5 /opt/gradle

# 配置环境变量
echo 'export PATH=$PATH:/opt/gradle/bin' >> ~/.bashrc
source ~/.bashrc
```

**验证安装**:
```bash
gradle --version
# 输出应包含 Gradle 8.0+
```

---

## 3. IDE 安装和配置

### 3.1 IntelliJ IDEA 安装

#### 下载 IDEA 2024.1+

访问 [JetBrains 官网](https://www.jetbrains.com/idea/download/) 下载：
- **Ultimate 版本** (推荐，支持完整功能)
- **Community 版本** (免费，功能足够开发插件)

#### 安装插件

打开 IDEA 后安装以下插件：

1. **必需插件**:
   - `Plugin DevKit` (插件开发工具，通常已预装)
   - `Gradle` (构建工具，通常已预装)

2. **推荐插件**:
   - `CheckStyle-IDEA` (代码风格检查)
   - `SonarLint` (代码质量检查)
   - `Rainbow Brackets` (括号高亮)
   - `GitToolBox` (Git增强)

### 3.2 配置 IntelliJ Platform SDK

1. 打开 `File > Project Structure > SDKs`
2. 点击 `+` > `Add IntelliJ Platform Plugin SDK`
3. 选择你的 IDEA 安装目录
4. SDK 名称设为 `IntelliJ IDEA 2024.1`

### 3.3 配置 JDK

1. 打开 `File > Project Structure > SDKs`
2. 确认已添加 JDK 17
3. 设置为项目默认 SDK

---

## 4. 代码编辑器配置 (用于 MCP Server 开发)

### 4.1 Visual Studio Code (推荐)

#### 安装 VSCode

访问 [VSCode 官网](https://code.visualstudio.com/) 下载安装。

#### 安装扩展

打开 VSCode Extensions (Ctrl+Shift+X / Cmd+Shift+X)：

**必需扩展**:
- `ESLint` (代码检查)
- `Prettier` (代码格式化)
- `TypeScript Vue Plugin (Volar)` (TypeScript支持)

**推荐扩展**:
- `GitLens` (Git增强)
- `Error Lens` (实时错误提示)
- `Todo Tree` (TODO高亮)
- `Path Intellisense` (路径自动补全)

#### 配置 settings.json

创建 `.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "typescript.tsdk": "node_modules/typescript/lib",
  "typescript.enablePromptUseWorkspaceTsdk": true
}
```

---

## 5. 克隆和初始化项目

### 5.1 克隆仓库 (后续创建后)

```bash
# 克隆项目
git clone https://github.com/your-org/idea-mcp.git
cd idea-mcp
```

### 5.2 初始化 IDEA Plugin 模块

```bash
cd idea-plugin

# 使用 Gradle Wrapper 构建
./gradlew build

# 如果是 Windows
gradlew.bat build
```

**首次构建说明**:
- 首次构建会下载依赖，可能需要10-15分钟
- 需要稳定的网络连接
- 如遇到下载失败，可配置国内镜像 (见下文)

### 5.3 初始化 MCP Server 模块

```bash
cd ../mcp-server

# 安装依赖
npm install

# 或使用 yarn
yarn install

# 或使用 pnpm (推荐，更快)
pnpm install
```

**首次安装说明**:
- 首次安装会下载所有 npm 依赖
- 如遇到网络问题，可配置淘宝镜像 (见下文)

---

## 6. 网络配置 (可选，中国大陆用户推荐)

### 6.1 配置 Gradle 镜像

创建或编辑 `~/.gradle/init.gradle`:

```groovy
allprojects {
    repositories {
        mavenLocal()
        maven { url 'https://maven.aliyun.com/repository/public/' }
        maven { url 'https://maven.aliyun.com/repository/spring/' }
        maven { url 'https://maven.aliyun.com/repository/google/' }
        maven { url 'https://maven.aliyun.com/repository/gradle-plugin/' }
        maven { url 'https://maven.aliyun.com/repository/spring-plugin/' }
        mavenCentral()
    }
}
```

### 6.2 配置 npm 镜像

```bash
# 使用淘宝镜像
npm config set registry https://registry.npmmirror.com

# 验证配置
npm config get registry
# 输出: https://registry.npmmirror.com/

# 或使用 nrm (推荐)
npm install -g nrm
nrm use taobao
```

---

## 7. 开发环境验证

### 7.1 验证 IDEA Plugin 环境

```bash
cd idea-plugin

# 运行测试
./gradlew test

# 启动插件沙箱 (会启动一个新的 IDEA 实例)
./gradlew runIde
```

**预期结果**:
- 测试通过 (初始可能没有测试)
- 启动新的 IDEA 窗口，插件已加载

### 7.2 验证 MCP Server 环境

```bash
cd mcp-server

# 编译 TypeScript
npm run build

# 或
npx tsc

# 运行测试 (如果有)
npm test
```

**预期结果**:
- TypeScript 编译成功
- 生成 `dist/` 目录

---

## 8. 开发工具配置

### 8.1 配置代码格式化

#### IDEA Plugin (Kotlin)

1. 打开 `File > Settings > Editor > Code Style > Kotlin`
2. 选择 `Scheme: Kotlin style guide` (IDEA 默认)
3. 或使用官方风格: `Set from... > Predefined Style > Kotlin style guide`
4. 配置自动格式化: `Editor > Code Style > Kotlin > Tabs and Indents`

#### MCP Server (TypeScript)

在 `mcp-server` 目录创建 `.prettierrc`:

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 100,
  "tabWidth": 2,
  "useTabs": false,
  "arrowParens": "avoid"
}
```

创建 `.eslintrc.json`:

```json
{
  "parser": "@typescript-eslint/parser",
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "plugins": ["@typescript-eslint"],
  "env": {
    "node": true,
    "es6": true
  },
  "parserOptions": {
    "ecmaVersion": 2022,
    "sourceType": "module"
  },
  "rules": {
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }]
  }
}
```

### 8.2 配置调试

#### 调试 IDEA Plugin

IDEA 中创建运行配置:
1. `Run > Edit Configurations`
2. 点击 `+` > `Gradle`
3. 配置:
   - Name: `Run Plugin`
   - Gradle project: `idea-plugin`
   - Tasks: `runIde`
   - VM options: `-Xmx2048m` (可选，增加内存)

#### 调试 MCP Server

VSCode 中创建 `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Debug MCP Server",
      "program": "${workspaceFolder}/mcp-server/src/index.ts",
      "preLaunchTask": "npm: build",
      "outFiles": ["${workspaceFolder}/mcp-server/dist/**/*.js"],
      "sourceMaps": true,
      "runtimeArgs": ["-r", "ts-node/register"],
      "env": {
        "NODE_ENV": "development"
      }
    }
  ]
}
```

---

## 9. 环境变量配置

### 9.1 必需环境变量

创建 `~/.bashrc` (Linux/macOS) 或系统环境变量 (Windows):

```bash
# JDK
export JAVA_HOME=/path/to/jdk-17
export PATH=$JAVA_HOME/bin:$PATH

# Node.js (如使用 nvm 则不需要)
export NODE_HOME=/path/to/node
export PATH=$NODE_HOME/bin:$PATH

# Gradle (可选)
export GRADLE_HOME=/opt/gradle
export PATH=$GRADLE_HOME/bin:$PATH
```

### 9.2 项目环境变量 (可选)

在项目根目录创建 `.env` (不要提交到 Git):

```bash
# IDEA Plugin
IDEA_MCP_PORT=58888
IDEA_MCP_TOKEN=your-secret-token-here

# MCP Server
IDEA_PLUGIN_URL=http://localhost:58888
LOG_LEVEL=debug
```

---

## 10. 常见问题排查

### 10.1 Gradle 构建失败

**问题**: 提示下载依赖失败
```
Could not resolve all dependencies...
```

**解决方案**:
1. 检查网络连接
2. 配置 Gradle 镜像 (见 6.1)
3. 清理缓存重试:
   ```bash
   ./gradlew clean --refresh-dependencies
   ```

### 10.2 npm install 失败

**问题**: 提示网络超时
```
npm ERR! network timeout...
```

**解决方案**:
1. 配置 npm 镜像 (见 6.2)
2. 清理缓存重试:
   ```bash
   npm cache clean --force
   npm install
   ```

### 10.3 IDEA 插件加载失败

**问题**: 运行 `runIde` 后插件未加载

**解决方案**:
1. 检查 `plugin.xml` 配置
2. 检查 JDK 版本是否匹配
3. 查看日志:
   ```bash
   ./gradlew runIde --info
   ```

### 10.4 TypeScript 编译错误

**问题**: `tsc` 报类型错误

**解决方案**:
1. 确保安装了所有依赖:
   ```bash
   npm install
   ```
2. 检查 `tsconfig.json` 配置
3. 更新 TypeScript 版本:
   ```bash
   npm install -D typescript@latest
   ```

---

## 11. 开发环境健康检查

运行以下命令验证环境完整性:

```bash
# 检查 Java
java -version

# 检查 Node.js
node --version
npm --version

# 检查 Git
git --version

# 检查 Gradle (可选)
gradle --version

# 构建 IDEA Plugin
cd idea-plugin && ./gradlew build && cd ..

# 构建 MCP Server
cd mcp-server && npm run build && cd ..

echo "✅ 开发环境配置完成！"
```

**预期输出**:
```
✅ 所有命令执行成功
✅ 没有错误信息
✅ 生成了构建产物
```

---

## 12. 下一步

环境配置完成后，请参考：
- **实现任务文档.md** - 开始开发任务
- **架构文档.md** - 理解系统架构
- **API端点清单.md** - 了解 API 设计

---

## 附录 A: 推荐开发工具

### A.1 数据库工具 (可选)
- **DBeaver** - 数据库管理 (如需要数据库)

### A.2 API 测试工具
- **Postman** - API 测试
- **Insomnia** - API 测试 (替代方案)
- **curl** - 命令行 API 测试

### A.3 文档工具
- **Typora** - Markdown 编辑器
- **Draw.io** - 流程图绘制

### A.4 性能分析工具
- **VisualVM** - Java 性能分析
- **Chrome DevTools** - Node.js 性能分析

---

## 附录 B: 参考资源

### B.1 官方文档
- [IntelliJ Platform SDK](https://plugins.jetbrains.com/docs/intellij/)
- [Gradle 文档](https://docs.gradle.org/)
- [Node.js 文档](https://nodejs.org/docs/)
- [TypeScript 文档](https://www.typescriptlang.org/docs/)
- [MCP 协议规范](https://modelcontextprotocol.io/)

### B.2 社区资源
- [JetBrains Platform Slack](https://plugins.jetbrains.com/slack)
- [Stack Overflow - intellij-plugin](https://stackoverflow.com/questions/tagged/intellij-plugin)

---

**文档维护**: 环境变更时需更新此文档。
