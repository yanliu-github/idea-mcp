# IntelliJ IDEA MCP 服务器 - 需求文档

## 文档信息

- **文档版本**: v1.0
- **创建日期**: 2025-11-13
- **文档状态**: 需求定义阶段
- **项目名称**: IDEA MCP Server

---

## 1. 项目概述

### 1.1 项目背景

当前 AI 辅助编程工具在进行代码重构、分析等操作时,通常需要：
- 大量搜索和解析代码文件
- 重新实现语义分析功能
- 无法保证重构的准确性和完整性
- 难以理解复杂的项目结构和依赖关系

IntelliJ IDEA 作为成熟的 IDE,已经具备完善的：
- 代码语义分析引擎 (PSI)
- 精确的重构引擎
- 完整的项目索引系统
- 强大的调试功能

### 1.2 项目目标

通过 MCP (Model Context Protocol) 协议将 IntelliJ IDEA 的强大功能暴露给 AI 助手,让 AI 能够：
- 调用 IDEA 的原生重构能力
- 使用 IDEA 的代码导航和搜索功能
- 执行 IDEA 的代码分析和检查
- 操作 IDEA 的调试器
- 访问完整的项目上下文

### 1.3 核心价值

- **精确性**: IDEA 的语义分析引擎比 AI 文本解析更准确
- **效率**: 直接利用 IDEA 的索引,无需大量搜索代码
- **可靠性**: 基于 IDEA 经过验证的重构引擎,保证代码正确性
- **完整性**: 访问 IDEA 的完整项目上下文和依赖关系

### 1.4 目标用户

- **AI 辅助编程工具用户**: 使用 Claude Code、Cursor 等 AI 工具的开发者
- **Java/Kotlin 开发者**: 需要精确重构和代码分析的开发者
- **团队协作**: 需要标准化重构操作的开发团队

---

## 2. 功能需求

### 2.1 重构功能

#### 2.1.1 重命名 (Rename)

**需求描述**:
- 重命名代码中的符号(变量、方法、类、包等)
- 自动更新所有引用位置
- 支持在注释和字符串中搜索
- 提供变更预览
- 检测命名冲突

**输入**:
- 文件路径
- 符号位置(偏移量)
- 新名称
- 是否在注释中搜索
- 是否在字符串中搜索
- 是否仅预览

**输出**:
- 受影响的文件列表
- 每个文件的具体变更
- 冲突警告
- 受影响的引用数量

**使用场景**:
- 重构代码以提高可读性
- 统一命名规范
- 修正拼写错误

#### 2.1.2 提取方法 (Extract Method)

**需求描述**:
- 将选中的代码片段提取为独立方法
- 自动识别参数和返回值
- 支持设置方法可见性
- 提供提取预览

**输入**:
- 文件路径
- 代码起始位置
- 代码结束位置
- 方法名称
- 方法可见性(private/public/protected)
- 是否为静态方法
- 是否仅预览

**输出**:
- 提取后的方法代码
- 调用点代码
- 完整的变更内容

**使用场景**:
- 简化长方法
- 提高代码复用性
- 改善代码可读性

#### 2.1.3 提取变量/常量 (Extract Variable/Constant)

**需求描述**:
- 将表达式提取为变量或常量
- 支持替换所有相同表达式
- 自动推断类型

**输入**:
- 文件路径
- 表达式位置
- 变量名称
- 是否为常量
- 是否替换所有出现

**输出**:
- 提取后的变量声明
- 变更内容

**使用场景**:
- 消除魔法数字
- 减少重复表达式
- 提高代码可维护性

#### 2.1.4 内联 (Inline)

**需求描述**:
- 将变量或方法内联到使用位置
- 支持内联所有使用或单个使用

**输入**:
- 文件路径
- 符号位置
- 是否内联所有使用

**输出**:
- 内联后的代码
- 变更内容

**使用场景**:
- 简化过度抽象
- 消除不必要的中间变量

#### 2.1.5 改变方法签名 (Change Signature)

**需求描述**:
- 修改方法的参数、返回值、可见性
- 自动更新所有调用点
- 支持添加/删除/重排参数

**输入**:
- 文件路径
- 方法位置
- 新参数列表
- 新返回类型
- 新可见性

**输出**:
- 方法签名变更
- 所有调用点变更

**使用场景**:
- API 演化
- 重构方法接口

#### 2.1.6 安全删除 (Safe Delete)

**需求描述**:
- 检查元素是否被使用
- 安全删除未使用的代码
- 显示所有使用位置

**输入**:
- 文件路径
- 元素位置
- 是否搜索注释

**输出**:
- 是否可以安全删除
- 所有使用位置列表

**使用场景**:
- 清理死代码
- 删除废弃 API

#### 2.1.7 移动类/方法 (Move)

**需求描述**:
- 移动类到不同包
- 移动方法到不同类
- 自动更新导入和引用

**输入**:
- 源文件路径
- 目标包/类
- 元素位置

**输出**:
- 移动后的文件结构
- 所有引用更新

**使用场景**:
- 重组代码结构
- 优化架构

---

### 2.2 代码导航功能

#### 2.2.1 查找用途 (Find Usages)

**需求描述**:
- 查找符号的所有使用位置
- 按类型分组(读/写/方法调用等)
- 支持不同搜索范围

**输入**:
- 文件路径
- 符号位置
- 搜索范围(project/module/directory)
- 是否包含测试代码

**输出**:
- 所有使用位置列表
- 每个位置的上下文
- 按类型分组的统计

**使用场景**:
- 影响分析
- 理解代码使用情况
- 重构前的安全检查

#### 2.2.2 跳转到定义 (Go to Definition)

**需求描述**:
- 跳转到符号的定义位置
- 支持跨文件跳转

**输入**:
- 文件路径
- 符号位置

**输出**:
- 定义所在文件
- 定义所在行号和列号
- 元素类型和签名

**使用场景**:
- 快速定位代码
- 理解符号定义

#### 2.2.3 查找实现 (Find Implementations)

**需求描述**:
- 查找接口或抽象方法的所有实现
- 查找类的所有子类

**输入**:
- 文件路径
- 接口/抽象方法位置

**输出**:
- 所有实现类/方法列表
- 每个实现的位置

**使用场景**:
- 理解多态实现
- 查找具体实现

#### 2.2.4 类型层次 (Type Hierarchy)

**需求描述**:
- 显示类的继承关系树
- 支持查看父类和子类

**输入**:
- 文件路径
- 类位置
- 方向(父类/子类/双向)

**输出**:
- 类型层次树结构

**使用场景**:
- 理解继承关系
- 架构分析

#### 2.2.5 调用层次 (Call Hierarchy)

**需求描述**:
- 显示方法的调用关系
- 支持查看调用者和被调用者

**输入**:
- 文件路径
- 方法位置
- 方向(调用者/被调用者/双向)

**输出**:
- 调用关系树

**使用场景**:
- 追踪方法调用链
- 理解执行流程

---

### 2.3 代码分析功能

#### 2.3.1 运行代码检查 (Run Inspections)

**需求描述**:
- 运行 IDEA 的代码检查规则
- 按严重程度过滤
- 提供快速修复建议

**输入**:
- 检查范围(file/directory/project)
- 文件路径(如果是文件级别)
- 严重程度过滤(error/warning/weak_warning)

**输出**:
- 问题列表
- 每个问题的位置、描述、严重程度
- 可用的快速修复选项

**使用场景**:
- 代码质量检查
- 发现潜在 bug
- 代码规范检查

#### 2.3.2 获取错误和警告 (Get Errors and Warnings)

**需求描述**:
- 获取文件的编译错误
- 获取语法和语义错误

**输入**:
- 文件路径

**输出**:
- 错误列表
- 警告列表
- 每个问题的位置和描述

**使用场景**:
- 实时代码验证
- 修复编译错误

#### 2.3.3 依赖分析 (Dependency Analysis)

**需求描述**:
- 分析模块/包之间的依赖关系
- 检测循环依赖
- 发现未使用的依赖

**输入**:
- 分析范围(module/package)
- 是否包含测试代码

**输出**:
- 依赖关系图
- 循环依赖列表
- 未使用的依赖

**使用场景**:
- 架构优化
- 解耦设计
- 清理依赖

---

### 2.4 调试功能

#### 2.4.1 断点管理

**需求描述**:
- 设置/删除断点
- 支持条件断点
- 支持日志断点
- 列出所有断点

**输入(设置断点)**:
- 文件路径
- 行号
- 条件表达式(可选)
- 日志消息(可选)
- 是否挂起线程

**输出**:
- 断点 ID
- 断点状态

**使用场景**:
- 调试程序
- 条件调试
- 日志输出

#### 2.4.2 启动调试 (Start Debug)

**需求描述**:
- 启动调试会话
- 支持指定运行配置
- 支持自定义参数和 VM 选项

**输入**:
- 运行配置名称(可选)
- 主类
- 程序参数
- VM 参数

**输出**:
- 调试会话 ID
- 会话状态

**使用场景**:
- 启动调试
- 问题排查

#### 2.4.3 调试控制 (Debug Control)

**需求描述**:
- 控制调试执行流程
- 支持继续、暂停、步进等操作

**输入**:
- 会话 ID
- 操作类型(continue/pause/step_over/step_into/step_out/stop)

**输出**:
- 操作结果
- 当前执行位置

**使用场景**:
- 单步调试
- 控制执行流程

#### 2.4.4 计算表达式 (Evaluate Expression)

**需求描述**:
- 在调试时计算表达式
- 支持访问当前作用域变量

**输入**:
- 会话 ID
- 表达式
- 栈帧索引

**输出**:
- 表达式结果
- 结果类型

**使用场景**:
- 检查变量值
- 测试表达式
- 即时计算

#### 2.4.5 查看和修改变量 (Variables)

**需求描述**:
- 查看当前作用域的所有变量
- 修改变量值
- 支持不同作用域(local/instance/static)

**输入(查看)**:
- 会话 ID
- 栈帧索引
- 作用域

**输入(修改)**:
- 会话 ID
- 变量名
- 新值
- 栈帧索引

**输出**:
- 变量列表及其值
- 修改结果

**使用场景**:
- 检查程序状态
- 测试不同场景
- 调试时修改值

---

### 2.5 代码生成功能

#### 2.5.1 生成 Getter/Setter

**需求描述**:
- 为类字段生成访问器方法
- 支持选择字段
- 支持批量生成

**输入**:
- 文件路径
- 类位置
- 字段名列表
- 是否生成 getter
- 是否生成 setter

**输出**:
- 生成的方法代码

**使用场景**:
- 快速生成访问器
- 遵循封装原则

#### 2.5.2 生成构造函数

**需求描述**:
- 生成参数化构造函数
- 支持选择字段
- 支持设置可见性

**输入**:
- 文件路径
- 类位置
- 字段名列表
- 可见性

**输出**:
- 生成的构造函数代码

**使用场景**:
- 快速生成构造器
- 初始化对象

#### 2.5.3 生成 equals/hashCode/toString

**需求描述**:
- 生成常用方法
- 支持选择参与的字段
- 遵循最佳实践

**输入**:
- 文件路径
- 类位置
- 方法类型列表(equals/hashCode/toString)
- 字段名列表

**输出**:
- 生成的方法代码

**使用场景**:
- 实现对象比较
- 实现哈希
- 调试输出

#### 2.5.4 创建测试

**需求描述**:
- 为类创建测试文件
- 生成测试方法骨架
- 支持不同测试框架

**输入**:
- 源文件路径
- 类位置
- 测试框架(JUnit4/JUnit5/TestNG)
- 要测试的方法列表
- 是否创建 setup/teardown

**输出**:
- 测试文件路径
- 测试文件内容

**使用场景**:
- 快速创建测试
- TDD 开发

---

### 2.6 搜索功能

#### 2.6.1 全局搜索 (Search Everywhere)

**需求描述**:
- 全局搜索类、文件、符号
- 支持模糊匹配
- 支持类型过滤

**输入**:
- 搜索查询
- 搜索类型(all/files/classes/symbols/actions)
- 是否包含库

**输出**:
- 搜索结果列表
- 每个结果的位置和类型

**使用场景**:
- 快速定位代码
- 查找类或方法

#### 2.6.2 文本搜索 (Find in Files)

**需求描述**:
- 在文件中搜索文本
- 支持正则表达式
- 支持文件类型过滤

**输入**:
- 搜索文本
- 搜索范围
- 是否大小写敏感
- 是否使用正则
- 文件类型过滤

**输出**:
- 匹配的文件和位置列表
- 匹配的上下文

**使用场景**:
- 查找特定文本
- 代码审查

#### 2.6.3 结构化搜索 (Structural Search)

**需求描述**:
- 基于代码结构搜索
- 支持模式变量
- 查找特定代码模式

**输入**:
- 搜索模式
- 搜索范围
- 是否大小写敏感

**输出**:
- 匹配的代码片段列表

**使用场景**:
- 查找设计模式
- 查找代码异味
- 批量重构准备

---

### 2.7 项目管理功能

#### 2.7.1 获取项目结构

**需求描述**:
- 获取项目的目录树结构
- 获取模块信息
- 获取依赖列表

**输入**:
- 是否包含库
- 最大深度

**输出**:
- 项目树形结构
- 模块列表
- 依赖关系

**使用场景**:
- 理解项目组织
- 生成项目文档

#### 2.7.2 构建项目 (Build)

**需求描述**:
- 编译项目
- 清理构建
- 获取构建结果

**输入**:
- 是否清理
- 模块名称(可选)

**输出**:
- 构建状态
- 构建时间
- 错误和警告列表

**使用场景**:
- 编译验证
- 持续集成

#### 2.7.3 运行测试 (Run Tests)

**需求描述**:
- 运行测试
- 收集覆盖率
- 获取测试结果

**输入**:
- 测试范围(test/class/method/package)
- 测试名称模式
- 是否收集覆盖率

**输出**:
- 通过/失败/跳过数量
- 失败测试详情
- 覆盖率数据

**使用场景**:
- 自动化测试
- 质量保证

---

### 2.8 代码格式化和优化

#### 2.8.1 格式化代码 (Format Code)

**需求描述**:
- 按照代码风格格式化
- 优化导入语句
- 重新排列代码

**输入**:
- 文件路径
- 范围(file/directory/project)
- 是否优化导入
- 是否重排代码

**输出**:
- 格式化结果

**使用场景**:
- 统一代码风格
- 代码提交前整理

#### 2.8.2 优化导入 (Optimize Imports)

**需求描述**:
- 移除未使用的导入
- 排序导入语句
- 优化导入组织

**输入**:
- 文件路径
- 范围

**输出**:
- 优化结果

**使用场景**:
- 清理导入
- 提高可读性

#### 2.8.3 应用快速修复 (Quick Fix)

**需求描述**:
- 应用 IDEA 的快速修复建议
- 自动修复常见问题

**输入**:
- 文件路径
- 问题位置
- 修复名称

**输出**:
- 修复结果

**使用场景**:
- 快速修复问题
- 自动化修复

---

## 3. 非功能需求

### 3.1 性能需求

- **响应时间**: 简单操作(查找定义)< 500ms,复杂操作(重构)< 5s
- **并发支持**: 支持至少 10 个并发请求
- **索引就绪**: 等待索引就绪,超时时间可配置
- **缓存策略**: 缓存项目结构、符号索引等信息

### 3.2 可靠性需求

- **错误处理**: 所有操作都有明确的错误信息和错误码
- **事务支持**: 重构操作支持预览和回滚
- **数据一致性**: 保证重构后代码的语法和语义正确性
- **稳定性**: 插件崩溃不影响 IDEA 主进程

### 3.3 安全性需求

- **认证**: 支持 Token 认证(可选)
- **授权**: 区分读操作和写操作权限
- **IP 限制**: 默认仅允许本地访问
- **审计日志**: 记录所有写操作
- **危险操作确认**: 删除、移动等操作需要确认

### 3.4 兼容性需求

- **IDEA 版本**: 支持 2024.1 及以上版本
- **语言支持**: Java, Kotlin, Scala, Groovy
- **构建工具**: Maven, Gradle
- **操作系统**: Windows, macOS, Linux

### 3.5 可维护性需求

- **模块化设计**: 功能模块独立,易于扩展
- **代码规范**: 遵循 IntelliJ Platform 插件开发规范
- **文档完整**: 包含 API 文档、开发文档、用户文档
- **测试覆盖**: 单元测试覆盖率 > 70%

### 3.6 可用性需求

- **配置简单**: 提供图形化配置界面
- **错误提示**: 清晰的错误信息和解决建议
- **进度反馈**: 长时间操作显示进度
- **操作可取消**: 支持取消正在执行的操作

---

## 4. 接口需求

### 4.1 MCP 协议要求

- **协议版本**: MCP 1.0
- **传输方式**: stdio (标准输入输出)
- **数据格式**: JSON-RPC 2.0
- **工具注册**: 所有功能作为 MCP tools 暴露
- **错误处理**: 符合 MCP 错误格式

### 4.2 HTTP API 要求

- **协议**: HTTP/1.1
- **端口**: 默认 58888(可配置)
- **数据格式**: JSON
- **认证**: Bearer Token(可选)
- **CORS**: 支持跨域(可配置)
- **API 版本**: v1

### 4.3 API 响应格式

```json
{
  "success": true,
  "data": { ... },
  "requestId": "uuid",
  "timestamp": 1234567890
}
```

### 4.4 错误响应格式

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误描述",
    "details": { ... }
  },
  "requestId": "uuid",
  "timestamp": 1234567890
}
```

### 4.5 完整错误码定义

#### 4.5.1 客户端错误 (4xx)

| 错误码 | HTTP状态 | 说明 | 示例场景 |
|-------|---------|------|---------|
| INVALID_PARAMETERS | 400 | 请求参数无效 | 缺少必需字段、参数类型错误 |
| MISSING_REQUIRED_FIELD | 400 | 缺少必需字段 | filePath 未提供 |
| INVALID_FILE_PATH | 400 | 文件路径无效 | 路径格式错误或包含非法字符 |
| INVALID_OFFSET | 400 | 偏移量无效 | offset < 0 或超出文件大小 |
| INVALID_RANGE | 400 | 范围无效 | startOffset > endOffset |
| INVALID_NAME | 400 | 名称无效 | 新名称包含非法字符或为空 |
| UNAUTHORIZED | 401 | 未授权访问 | 未提供 Token 或 Token 过期 |
| INVALID_TOKEN | 401 | Token 无效 | Token 格式错误或不匹配 |
| FORBIDDEN | 403 | 禁止访问 | 无权限执行写操作 |
| IP_NOT_ALLOWED | 403 | IP 地址不在白名单 | 非本地访问被拒绝 |
| FILE_NOT_FOUND | 404 | 文件未找到 | 指定路径的文件不存在 |
| ELEMENT_NOT_FOUND | 404 | 元素未找到 | 指定偏移量处无有效元素 |
| PROJECT_NOT_FOUND | 404 | 项目未找到 | 未打开任何项目 |
| MODULE_NOT_FOUND | 404 | 模块未找到 | 指定模块不存在 |
| METHOD_NOT_ALLOWED | 405 | 方法不允许 | 使用了错误的 HTTP 方法 |
| NAMING_CONFLICT | 409 | 命名冲突 | 新名称已被使用 |
| ELEMENT_IN_USE | 409 | 元素正在使用中 | 无法删除正在被引用的元素 |
| UNSUPPORTED_MEDIA_TYPE | 415 | 不支持的媒体类型 | Content-Type 不是 application/json |
| RATE_LIMIT_EXCEEDED | 429 | 请求频率超限 | 超过每分钟最大请求数 |

#### 4.5.2 服务端错误 (5xx)

| 错误码 | HTTP状态 | 说明 | 示例场景 |
|-------|---------|------|---------|
| INTERNAL_ERROR | 500 | 内部错误 | 未预期的异常 |
| REFACTORING_FAILED | 500 | 重构失败 | 重构操作执行失败 |
| OPERATION_CANCELLED | 500 | 操作被取消 | 用户取消了操作 |
| PSI_OPERATION_FAILED | 500 | PSI 操作失败 | PSI 树操作异常 |
| WRITE_ACTION_FAILED | 500 | 写操作失败 | WriteAction 执行失败 |
| COMPILATION_ERROR | 500 | 编译错误 | 项目存在编译错误 |
| INDEX_NOT_READY | 503 | 索引未就绪 | IDEA 正在建立索引 |
| SERVICE_UNAVAILABLE | 503 | 服务不可用 | 服务器正在启动或停止 |
| IDEA_NOT_READY | 503 | IDEA 未就绪 | IDEA 初始化中 |
| TIMEOUT | 504 | 操作超时 | 操作执行时间超过限制 |

#### 4.5.3 错误响应示例

**文件未找到**:
```json
{
  "success": false,
  "error": {
    "code": "FILE_NOT_FOUND",
    "message": "File not found: /src/User.java",
    "details": {
      "filePath": "/src/User.java",
      "suggestion": "Please check if the file exists and the path is correct"
    }
  },
  "requestId": "req-1234-5678",
  "timestamp": 1700000000000
}
```

**命名冲突**:
```json
{
  "success": false,
  "error": {
    "code": "NAMING_CONFLICT",
    "message": "Name 'Customer' already exists in the same package",
    "details": {
      "newName": "Customer",
      "conflictingElement": {
        "name": "Customer",
        "type": "CLASS",
        "file": "/src/Customer.java",
        "line": 10
      },
      "suggestion": "Please choose a different name or resolve the conflict"
    }
  },
  "requestId": "req-1234-5679",
  "timestamp": 1700000000000
}
```

**索引未就绪**:
```json
{
  "success": false,
  "error": {
    "code": "INDEX_NOT_READY",
    "message": "Project index is not ready. Please wait for indexing to complete.",
    "details": {
      "indexingProgress": 45,
      "estimatedTime": 120,
      "suggestion": "Please wait for indexing to complete before performing this operation"
    }
  },
  "requestId": "req-1234-5680",
  "timestamp": 1700000000000
}
```

**详细错误码定义**: 参见 [API端点清单.md](./API端点清单.md#11-错误码定义)

---

## 5. 约束条件

### 5.1 技术约束

- **开发语言**:
  - IDEA Plugin: Kotlin 1.9+ (JVM 目标 17)
  - MCP Server: TypeScript/Node.js (最低 Node.js 18)
- **依赖框架**:
  - IntelliJ Platform SDK 2024.1+
  - HTTP Server: Undertow 2.3+
  - MCP SDK: @modelcontextprotocol/sdk
- **项目结构**:
  - 单仓库多模块 (Monorepo)
  - 包名: com.ly.ideamcp
- **通信协议**:
  - MCP 通信: stdio (标准输入输出)
  - Plugin 通信: HTTP REST API

### 5.2 部署约束

- **插件安装**: 通过 IDEA Plugin Marketplace 或本地安装
- **MCP Server**: 作为独立进程运行,通过 stdio 与 AI 工具通信
- **网络要求**: HTTP Server 默认仅监听 localhost (127.0.0.1)

### 5.3 开发约束

- **开发工具**: IntelliJ IDEA 2024.1+
- **构建工具**: Gradle 8.0+
- **代码规范**: Google Java Style Guide

---

## 6. 验收标准

### 6.1 MVP 阶段验收标准

- [ ] IDEA 插件可以正常安装和启动
- [ ] HTTP Server 正常运行在指定端口
- [ ] MCP Server 可以通过 stdio 与 Claude Code 通信
- [ ] 重命名功能可以正常工作,更新所有引用
- [ ] 查找用途功能可以找到所有使用位置
- [ ] 跳转到定义功能可以正确跳转
- [ ] 代码检查功能可以发现问题并提供修复建议
- [ ] 基础错误处理正常工作
- [ ] 单元测试通过率 > 80%

### 6.2 功能完整性验收标准

- [ ] 所有重构功能正常工作(8 个)
- [ ] 所有导航功能正常工作(5 个)
- [ ] 所有分析功能正常工作(3 个)
- [ ] 所有调试功能正常工作(5 个)
- [ ] 所有代码生成功能正常工作(4 个)
- [ ] 所有搜索功能正常工作(3 个)
- [ ] 所有项目管理功能正常工作(3 个)
- [ ] 所有格式化功能正常工作(3 个)

### 6.3 性能验收标准

- [ ] 简单操作(查找定义)响应时间 < 500ms
- [ ] 复杂操作(大型重构)响应时间 < 10s
- [ ] 支持 10 个并发请求不崩溃
- [ ] 大型项目(100k+ 行)索引时间 < 5 分钟

### 6.4 质量验收标准

- [ ] 单元测试覆盖率 > 70%
- [ ] 集成测试覆盖率 > 50%
- [ ] 无已知的 Critical 和 High 级别 bug
- [ ] API 文档完整
- [ ] 用户文档完整

---

## 7. 风险和依赖

### 7.1 技术风险

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| IntelliJ Platform API 变更 | 高 | 中 | 定义支持的版本范围,跟踪 API 变化 |
| PSI 操作复杂度高 | 中 | 高 | 创建辅助工具类,参考官方插件 |
| 性能问题(大项目) | 高 | 中 | 实现缓存策略,异步处理 |
| 线程安全问题 | 高 | 中 | 严格遵循线程模型,使用 ReadAction/WriteAction |

### 7.2 项目依赖

| 依赖项 | 用途 | 版本要求 | 关键性 |
|--------|------|----------|--------|
| IntelliJ Platform SDK | 插件开发 | 2024.1+ | 高 |
| JDK | Java 运行时 | 17+ | 高 |
| Undertow | HTTP Server | 2.3+ | 高 |
| Gson | JSON 序列化 | 2.10+ | 中 |
| MCP SDK | MCP 协议实现 | 0.5+ | 高 |
| Node.js | MCP Server 运行时 | 18+ | 高 |
| Axios | HTTP 客户端 | 1.6+ | 中 |

### 7.3 外部依赖

- **IntelliJ IDEA**: 用户必须安装并运行 IDEA
- **项目索引**: 功能依赖于 IDEA 完成项目索引
- **AI 工具**: 需要支持 MCP 协议的 AI 工具(如 Claude Code)

---

## 8. 未来扩展

### 8.1 后续扩展方向

- **更多语言支持**: Python, JavaScript, Go
- **远程开发**: 支持远程 IDEA 实例
- **插件市场**: 支持第三方扩展

---

## 9. 术语表

| 术语 | 定义 |
|------|------|
| MCP | Model Context Protocol,AI 工具与外部系统通信的协议 |
| PSI | Program Structure Interface,IntelliJ 的代码结构接口 |
| IDEA | IntelliJ IDEA,JetBrains 的集成开发环境 |
| 重构 | 在不改变代码行为的前提下改进代码结构 |
| 索引 | IDEA 对项目代码的结构化分析数据 |
| 偏移量 | 字符在文件中的位置(从 0 开始) |
| ReadAction | IDEA 中的读操作,保证线程安全 |
| WriteAction | IDEA 中的写操作,保证线程安全 |

---

## 附录 A: 参考文档

- [IntelliJ Platform SDK 文档](https://plugins.jetbrains.com/docs/intellij/)
- [MCP 协议规范](https://modelcontextprotocol.io/)
- [Claude Code 文档](https://docs.claude.com/claude-code/)

---

**文档维护**: 本文档由项目团队维护,任何需求变更都需要更新此文档。
